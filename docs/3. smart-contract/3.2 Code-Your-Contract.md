---
sidebar_position: 2
---

# Code your contract

:::tip

The code in this example can be cloned from: https://github.com/gldeng/aelf-nus-workshop-2024-example-code/tree/main/contract.

:::

## 1. Edit files

### 1.1. Edit file `src/Protobuf/contract/hello_world_contract.proto` and copy/paste the following:

```protobuf title="src/Protobuf/contract/hello_world_contract.proto" showLineNumbers
syntax = "proto3";

import "aelf/core.proto";
import "aelf/options.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/wrappers.proto";
// highlight-next-line
import "Protobuf/reference/acs12.proto";
// Define the namespace of this class.
option csharp_namespace = "AElf.Contracts.HelloWorld";

service HelloWorld {
    // Declare a state class, need to create a corresponding state class file.
    option (aelf.csharp_state) = "AElf.Contracts.HelloWorld.HelloWorldState";
    // highlight-next-line
    option (aelf.base) = "Protobuf/reference/acs12.proto";

    // Actions
    // Define methods name and input/output.
    rpc Update (google.protobuf.StringValue) returns (google.protobuf.Empty);
// highlight-start
    rpc Initialize (google.protobuf.Empty) returns (google.protobuf.Empty);
    rpc CreateCharacter (google.protobuf.Empty) returns (Character);
// highlight-end

    // Views
    // Define methods name and input/output. Need to add "is_view=true" attribute.
    rpc Read (google.protobuf.Empty) returns (google.protobuf.StringValue) {
        option (aelf.is_view) = true;
    }
// highlight-start
    rpc GetMyCharacter (google.protobuf.Empty) returns (Character) {
        option (aelf.is_view) = true;
    }
// highlight-end
}

// highlight-start
message Character {
    int32 health = 1;
    int32 strength = 2;
    int32 speed = 3;
}
// highlight-end

// Define the class of input/output.
message UpdatedMessage {
    option (aelf.is_event) = true;
    string value = 1;
}
```

### 1.2. Edit file `src/HelloWorld.cs` and copy/paste the following:

```csharp title="src/HelloWorld.cs" showLineNumbers
using AElf.Sdk.CSharp;
using Google.Protobuf.WellKnownTypes;

namespace AElf.Contracts.HelloWorld
{
    // Contract class must inherit the class generated by the proto file
    public class HelloWorld : HelloWorldContainer.HelloWorldBase
    {
        // adding this line is for preparing the contract deployment later,
        // to differentiate each person's contract.
        // This is because our testnet does not allow the deployment of two identical contracts.
        // highlight-next-line
        const string author = "your name";

        // Method to update the message value.
        public override Empty Update(StringValue input)
        {
            // Set the message value in the contract state
            State.Message.Value = input.Value;
            // Emit an event to notify listeners about the something happened during the execution of this method
            Context.Fire(new UpdatedMessage
            {
                Value = input.Value
            });
            // Return an empty response
            return new Empty();
        }

// highlight-start
        public override Empty Initialize(Empty input)
        {
            Assert(!State.Initialized.Value, "already initialized");
            State.RandomNumberContract.Value =
                Context.GetContractAddressByName(SmartContractConstants.ConsensusContractSystemName);
            return new Empty();
        }
// highlight-end

        // Method to read the current message value
        public override StringValue Read(Empty input)
        {
            // Retrieve the value from the state
            var value = State.Message.Value;
            // Return value retrieved
            return new StringValue
            {
                Value = value
            };
        }

// highlight-start
        public override Character CreateCharacter(Empty input)
        {
            var existing = State.Characters[Context.Sender];
            Assert(existing == null, "already has a character");
            var randomBytes = State.RandomNumberContract.GetRandomBytes
                .Call(new Int64Value { Value = Context.CurrentHeight - 1 }.ToBytesValue()).Value.ToByteArray();
            var hash = HashHelper.ComputeFrom(Context.Sender).Value.ToByteArray();

            var character = new Character
            {
                Health = 60 + (randomBytes[0] ^ hash[0]) % 41, // Health is 60 ~ 100
                Strength = 40 + (randomBytes[1] ^ hash[1]) % 61, // Strength is 40 ~ 100
                Speed = 100 + (randomBytes[2] ^ hash[2]) % 101 // Strength is 100 ~ 200
            };
            State.Characters[Context.Sender] = character;
            return character;
        }

        public override Character GetMyCharacter(Empty input)
        {
            return State.Characters[Context.Sender] ?? new Character();
        }
// highlight-end
    }
}
```

## 2. Add files

### 2.1. Create a new file `src/Protobuf/reference/acs6.proto` and copy/paste the following:

:::tip

For more information on ACS6, refer to https://docs.aelf.io/en/latest/reference/acs/acs6.html

:::

```protobuf title="src/Protobuf/reference/acs6.proto" showLineNumbers
syntax = "proto3";

package acs6;

import "aelf/options.proto";
import "aelf/core.proto";
import "google/protobuf/wrappers.proto";

option (aelf.identity) = "acs6";
option csharp_namespace = "AElf.Standards.ACS6";

service RandomNumberProvideacsrContract {
    rpc GetRandomBytes (google.protobuf.BytesValue) returns (google.protobuf.BytesValue) {
        option (aelf.is_view) = true;
    }
}

// Events

message RandomBytesGenerated {
    option (aelf.is_event) = true;
    bytes argument = 1;
    bytes random_bytes = 2;
}
```

### 2.2. Create a new file `src/Protobuf/reference/acs12.proto` and copy/paste the following:

:::tip

For more information on ACS12, refer to https://docs.aelf.io/en/latest/reference/acs/acs12.html

:::

```protobuf title="src/Protobuf/reference/acs12.proto" showLineNumbers
/**
 * AElf Standards ACS12(User Contract Standard)
 *
 * Used to manage user contract.
 */
syntax = "proto3";

package acs12;

import public "aelf/options.proto";
import public "google/protobuf/empty.proto";
import public "google/protobuf/wrappers.proto";
import "aelf/core.proto";

option (aelf.identity) = "acs12";
option csharp_namespace = "AElf.Standards.ACS12";

service UserContract{

}

//Specified method fee for user contract.
message UserContractMethodFees {
    // List of fees to be charged.
    repeated UserContractMethodFee fees = 2;
    // Optional based on the implementation of SetConfiguration method.
    bool is_size_fee_free = 3;
}

message UserContractMethodFee {
    // The token symbol of the method fee.
    string symbol = 1;
    // The amount of fees to be charged.
    int64 basic_fee = 2;
}
```
